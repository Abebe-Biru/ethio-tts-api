[build]
builder = "NIXPACKS"

[build.env]
PYTHON_VERSION = "3.10"

[phases.install]
cmds = [
  "pip install --upgrade pip",
  "pip install torch==2.5.1+cpu --index-url https://download.pytorch.org/whl/cpu",
  "pip install --no-deps transformers>=4.57.0",
  "pip install boltons>=25.0.0 deepdiff>=8.6.1 diskcache>=5.6.3 fastapi>=0.119.0 glom>=24.11.0 httpx>=0.27.0 prometheus-client>=0.19.0 pyinstrument>=5.1.1 pydantic-settings>=2.0.0 pyrsistent>=0.20.0 sentencepiece>=0.2.1 setuptools>=65.0.0 soundfile>=0.13.1 structlog>=25.4.0 tenacity>=9.1.2 tqdm>=4.66.0 uroman>=0.3.0 uvicorn[standard]>=0.37.0"
]

[deploy]
startCommand = "python -m api"
healthcheckPath = "/v1/health"
healthcheckTimeout = 100
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3